<!DOCTYPE html>
<html>
<head>
    <title>Ball Adventure</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial;
        }
        #gameCanvas {
            background: #87CEEB;
        }
        #hud {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            text-shadow: 2px 2px 2px black;
        }
    </style>
</head>
<body>
    <div id="hud">Дистанция: <span id="distance">0</span>м</div>
    <canvas id="gameCanvas"></canvas>
    
    <!-- Аудио элементы -->
    <audio id="bgMusic" loop>
        <source src="https://cdn.pixabay.com/download/audio/2022/02/22/audio_6e5d2d6728.mp3" type="audio/mpeg">
    </audio>
    <audio id="jumpSound" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_3d3555d530.mp3"></audio>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Система состояний игры
        const GameState = {
            current: 'playing',
            lastCheckpoint: { x: 100, y: canvas.height - 150 },
            distance: 0,
            difficulty: 1
        };

        // Игровые объекты
        const ball = {
            x: 100,
            y: canvas.height - 150,
            radius: 20,
            color: '#FF4500',
            velocityX: 0,
            velocityY: 0,
            jumpForce: -18,
            canJump: true
        };

        let platforms = [];
        let obstacles = [];
        let checkpoints = [];

        // Инициализация
        function initGame() {
            platforms = [
                {x: 0, y: canvas.height - 50, width: canvas.width, height: 50, type: 'ground'},
                {x: 300, y: canvas.height - 200, width: 150, height: 20, type: 'normal'},
                {x: 600, y: canvas.height - 300, width: 150, height: 20, type: 'normal'}
            ];

            obstacles = [];
            checkpoints = [];
            generateCheckpoint(500);
            
            document.getElementById('bgMusic').play();
        }

        // Генерация чекпоинтов
        function generateCheckpoint(x) {
            checkpoints.push({
                x: x,
                y: canvas.height - 250,
                width: 40,
                height: 60,
                activated: false
            });
        }

        // Физика и управление
        const physics = {
            gravity: 0.7,
            friction: 0.85,
            moveSpeed: 8,
            cameraOffset: 0,
            maxDifficulty: 5
        };

        // Обработка ввода
        const keys = {};
        window.addEventListener('keydown', e => {
            keys[e.key] = true;
            if (e.code === 'Space' && ball.canJump && GameState.current === 'playing') {
                ball.velocityY = ball.jumpForce * (1 - GameState.difficulty*0.05);
                document.getElementById('jumpSound').play();
                ball.canJump = false;
            }
        });
        window.addEventListener('keyup', e => keys[e.key] = false);

        // Основной цикл
        function update() {
            if(GameState.current !== 'playing') return;

            // Движение
            ball.velocityX = keys['ArrowLeft'] ? -physics.moveSpeed : 
                            keys['ArrowRight'] ? physics.moveSpeed : 0;
            
            // Физика
            ball.velocityY += physics.gravity * GameState.difficulty;
            ball.x += ball.velocityX;
            ball.y += ball.velocityY;

            // Проверка смерти
            if(ball.y > canvas.height + 100) {
                GameState.current = 'dead';
                setTimeout(() => {
                    ball.x = GameState.lastCheckpoint.x;
                    ball.y = GameState.lastCheckpoint.y;
                    GameState.current = 'playing';
                }, 1000);
                return;
            }

            // Коллизии с платформами
            checkCollisions();
            updateCamera();
            updateDifficulty();
            generateWorld();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Рисование мира
            ctx.save();
            ctx.translate(-physics.cameraOffset, 0);

            // Платформы
            platforms.forEach(p => {
                ctx.fillStyle = p.type === 'ground' ? '#228B22' : '#4682B4';
                ctx.fillRect(p.x, p.y, p.width, p.height);
            });

            // Чекпоинты
            checkpoints.forEach(cp => {
                ctx.fillStyle = cp.activated ? '#32CD32' : '#FFD700';
                ctx.fillRect(cp.x, cp.y, cp.width, cp.height);
            });

            // Шарик
            ctx.beginPath();
            ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
            ctx.fillStyle = ball.color;
            ctx.fill();

            ctx.restore();

            // HUD
            document.getElementById('distance').textContent = 
                Math.floor(GameState.distance / 10);
        }

        // Вспомогательные функции
        function checkCollisions() {
            ball.canJump = false;
            
            platforms.forEach(p => {
                if(checkCollision(p)) {
                    ball.velocityY = 0;
                    ball.y = p.y - ball.radius;
                    ball.canJump = true;
                }
            });

            checkpoints.forEach(cp => {
                if(!cp.activated && checkCollision(cp)) {
                    cp.activated = true;
                    GameState.lastCheckpoint = {x: cp.x + 20, y: cp.y - 50};
                }
            });
        }

        function checkCollision(obj) {
            return ball.x + ball.radius > obj.x &&
                   ball.x - ball.radius < obj.x + obj.width &&
                   ball.y + ball.radius > obj.y &&
                   ball.y - ball.radius < obj.y + obj.height;
        }

        function updateCamera() {
            physics.cameraOffset = ball.x - canvas.width * 0.3;
            GameState.distance = physics.cameraOffset;
        }

        function updateDifficulty() {
            GameState.difficulty = 1 + Math.floor(GameState.distance / 3000);
            if(GameState.difficulty > physics.maxDifficulty) {
                GameState.difficulty = physics.maxDifficulty;
            }
        }

        function generateWorld() {
            // Генерация новых платформ и чекпоинтов
            if(platforms[platforms.length-1].x < physics.cameraOffset + canvas.width + 500) {
                const lastX = platforms[platforms.length-1].x;
                platforms.push({
                    x: lastX + 300 + Math.random() * 200,
                    y: canvas.height - (100 + Math.random() * 300),
                    width: 150 + Math.random() * 100,
                    height: 20,
                    type: 'normal'
                });

                if(Math.random() > 0.7) {
                    generateCheckpoint(lastX + 400);
                }
            }
        }

        // Запуск игры
        initGame();
        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        gameLoop();
    </script>
</body>
</html>
